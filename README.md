# Из-за ужасной нехватки времени проект недоделан, реализована только первая часть с коммутатором

# Описание решения
## Коммутатор
### Общее описание
Коммутатор отвечает за генерацию и поставку CDR (Call Data Record) файлов другим сервисам системы. CDR включает в себя данные о данные о транзакциях, в которые входит информация о типе транзакции, номерах обслуживаемого и вызываемого абонентов, а также время начала и конца транзакции.

### Режимы работы
В рамках задания коммутатор способен работать в двух режимах: генерация CDR и чтение существующих CDR-файлов из определённой в конфигурации директории.

#### Режим генерации CDR
Генерация CDR файлов должна происходить параллельно, чтобы имитировать реальную систему, однако подобная стратегия вызывает определённые сложности с связи с существованием других требований, а именно: хронология транзакций должна обязательно соблюдаться.

Исходя из существующих условий была выбрана следующая стратегия генерации CDR-файлов:
CDR-файлы собираются в процессе генерации транзакций. Для работоспособности этой стратегии необходимо ввести несколько ограничений:
1. Потоки генерируют записи независимо, из-за чего разброс может получиться значительным (1 поток может генерировать данные уже за следующий месяц, в то время как остальные всё ещё генерируют звонки за предыдущий). Вариант решения этой проблемы - синхронизация потоков таким образом, чтобы они не могли сильно убежать друг от друга по времени генерации записей. Хороший вариант - введение временного "потолка". **Поток прекращает генерацию новых записей, когда достигает установленного "потолка"**;
2. Второй момент, который подвергает сомнению хронологический порядок записей - чтение из очереди. Даже с ограничениями на одновременный верхний предел, нет гарантии, что значения в очередь попадут в правильном порядке (например, один поток всё ещё может убежать вперёд и положить в очередь большое значение начала звонка). Здесь и появляется второе условие: чтение из очереди не должно происходить в момент генерации новых значений. **Необходимо установить синхронизатор, который будет гарантировать порядок чтения и генерации новых записей**.

Эти два установленных ограничения могут в большей степени гарантировать хронологический порядок записей в CDR.

#### Режим чтения CDR
Этот режим работы коммутатора не требует особых ограничений. Разве что отправка файлов должна происходить последовательно в одном потоке, чтобы гарантировать хронологический порядок записей.
Формат названия CDR-файла: **НОМЕР_CDR.txt**

### Способы проверки
Для удобства проверки было реализовано несколько опций просмотра сгенерированных CDR-файлов:
1. Непосредственно просмотр сгенерированных .txt файлов;
2. H2 консоль, доступная либо по **localhost:8083/h2-console/**, либо по **localhost:8080/h2-console/** в случае доступа через api-gateway.

#### Схема H2 базы данных
![image](https://github.com/ShipIM/nexign-project/assets/92543908/0e6efa05-5f91-4c92-846b-89fc4926b7f3)

### Нюансы
Помимо генерации параллельных транзакций для нескольких пользователей, они также могут генерироваться для одного пользователя. То есть возможна ситуация, при которой в один момент времени один и тот же пользователь может участвовать в нескольких транзакциях. 
